{layout name="layout" /}
<block name="titel"><title>我的订单</title></block>
<block name="resources">
    {load href="__PUBLIC__/login/login.css" /}
    {load href="__PUBLIC__/homestatic/css/myhome.css" /}
</block>
<style>

    left {
        width: 200px;
        height: 100%;
        border-right: 1px solid #CCCCCC;
        color: #000000;
        font-size: 14px;
        text-align: center;
        position: absolute;
        top: 80px;
        left: 0px;
        bottom: 100px;
        position: fixed;
    }

    .div1 {
        text-align: center;
        width: 200px;
        padding-top: 30px;

    }

    .div2 {
        height: 40px;
        line-height: 40px;
        cursor: pointer;
        font-size: 13px;
        position: relative;
        border-bottom: #ccc 1px dotted;

    }

    .div2 a {
        color: #000000;
    }

    .div2 a:hover {
        color: red;
    }

    .jbsz {
        position: absolute;
        height: 20px;
        width: 20px;
        left: 40px;
        top: 10px;
    }

    .right {
        position: relative;
        left: 250px;
        top: 30px;
        right: 0;
        bottom: 0;
        overflow: hidden;

    }

    .conten_margin {
        /*margin-bottom: 20px;*/
        /*margin-right: 20px;*/
        float: left;
        padding: 5px;

    }

    .conten_margin:hover {
        /*border: 1px solid silver;*/
    }

    .conten_margin .titlea {
        width: 180px;
        overflow: hidden; /*超出的隐藏掉*/
        text-overflow: ellipsis; /*超出的用....*/
        white-space: nowrap; /*不换行*/
        color: #666666;
        font-size: 13px;
    }

    .bordera {
        float: left;
        padding: 5px;
        border: 1px solid silver;
        color: #666666;
        font-size: 13px;

    }

    .bordera:hover {
        border: 1px solid red;
        color: red;
    }

    .borderb {
        float: left;
        padding: 5px;
        border: 1px solid silver;
        color: red;
        font-size: 13px;
    }

    .borderb:hover {
        border: 1px solid red;
    }

    .pricea {
        font-size: 18px;
        color: red;
    }

    .pingjiaa {
        font-size: 13px;
        color: #666666;
    }

    .pingjiab {
        font-size: 18px;
        color: red;
    }

    .img_xing {
        vertical-align: middle;
    }

    .btn_guanzhu {
        border: 0;
        background: #F4F4F4;
        vertical-align: middle;
        font-size: 13px;
    }

    #myhomem {
        position: absolute;
        left: 300px;
        top: 30px;
        right: 0px;
        bottom: 0;
        overflow: hidden;
    }

    .s-bar {
        font-family: tahoma, arial, 'Hiragino Sans GB', 'Microsoft YaHei', 宋体, sans-serif;
        color: #fff;
        background: #a0cdeb;
        border: #a0cdeb;
        border-top: #e4eaee;
        font-size: 18px;
        line-height: 18px;
        padding: 11px 10px;
        position: relative;
        width: 85%;
    }

    .text-mod {
        font-family: sans-serif;
        color: #333;
        text-decoration: none;
        line-height: 1;
        font-size: 15px;
    }
</style>
<asidehome>
    <div class="left">
        <div class="div1">
            <div class="div2">
                <div class="div2" style="font-size:25px;font-family: '楷体', '微软雅黑'">
                    <h2>全部功能</h2>
                </div>
                <div class="div2">
                    <div class="div2">
                        <div class="jbsz"></div>
                        <a href="{:url('home/user/userHome')}">我的收藏</a></div>
                    <div class="div2">
                        <div class="jbsz"></div>
                        <a href="{:url('home/user/userOrders',['type'=>'all'])}" style="color: #00a2d4;">全部订单</a>
                    </div>
                    <div class="div2">
                        <div class="jbsz"></div>
                        <a href="{:url('home/user/showCart')}">我的购物车</a></div>
                    <div class="div2">
                        <div class="jbsz"></div>
                        <a href="{:url('home/user/userMessage')}">我的个人资料</a></div>
                    <div class="div2">
                        <div class="jbsz"></div>
                        <a href="">我的评价</a></div>
                    <div class="div2">
                        <div class="jbsz"></div>
                        <a>退换货</a></div>

                </div>
            </div>
        </div>
    </div>
</asidehome>
<div id="myhomem">
    <div id="con">
        <div style="height: 80px;"></div>
        <div id="box_userMsg">
            <div id="box_user">
                <img src="{$iconRoot.$user['icon']}" height="90" width="90" class="img-circle">&nbsp;&nbsp;&nbsp;
                <span><a href="{:url('home/user/userMessage')}">{$user['user_name']}</a></span>
            </div>
            <div id="box_userSta"></div>
        </div>
        <table border="1" width="700px">
            <tr>
                <th><a href="{:url('home/user/userOrders',['type'=>'statu0'])}">待付款<i style="color: red">{$order_0}</i></a>
                </th>
                <th><a href="{:url('home/user/userOrders',['type'=>'statu1'])}">待发货<i style="color: red">{$order_2+$order_1}</i></a>
                </th>
                <th><a href="{:url('home/user/userOrders',['type'=>'statu3'])}">待收货<i style="color: red">{$order_3}</i></a>
                </th>
                <th><a href="{:url('home/user/userOrders',['type'=>'statu5'])}">待评价<i style="color: red">{$order_5}</i></a>
                </th>
                <th><a href="{:url('home/user/userOrders',['type'=>'statu6'])}">退款返修<i style="color: red">0</i></a></th>
            </tr>
        </table>
        <div style="height: 10px"></div>

        <!--第二层开始【我的订单】-->
        <div id="box_order_content">
            <div class="s-bar">我的订单</div>
            <div style="height: 10px"></div>
            {volist name="orders" id="order"}
            <table width="85%" border="1" cellpadding="0" cellspacing="0" style="table-layout:fixed">
                <tr>
                    <td rowspan="3">
                        <img src="{$imgRoot}{$order['orderSpecifications'][0]['specification']['commodity']['images'][0]['image']}"
                             style="height: 90px;width: 80px;" class="img-rounded"/>
                    </td>
                    <td style="text-overflow: ellipsis;overflow:hidden;width: 40%;">
                        <a href="{:url('home/user/orderDetailed',['orderId'=>$order['id']])}"
                           style="color: black;font-family: 微软雅黑">
                            {$order['orderSpecifications'][0]['specification']['commodity']['title']}
                        </a>
                    </td>
                    <td rowspan="3">
                        <div style="width: 100px"></div>
                    </td>
                    <td rowspan="3">
                        {switch name="$order->getData('status')"}
                        {case value="0"}
                        <span class="label label-danger">待付款</span>
                        {/case}
                        {case value="1"}
                        <span class="label label-info">待捡货</span>
                        {/case}
                        {case value="2"}
                        <span class="label label-info">待发货</span>
                        {/case}
                        {case value="3"}
                        <span class="label label-info">配送中</span>
                        {/case}
                        {case value="4"}
                        <span class="label label-info">货到付款</span>
                        {/case}
                        {case value="5"}
                        <span class="label label-success">交易完成</span>
                        {/case}
                        {case value="7"}
                        <span class="label label-info">交易关闭</span>
                        {/case}
                        {default /}

                        {/switch}
                    </td>
                    <td rowspan="3">
                        <div style="width: 100px"></div>
                    </td>
                    <td rowspan="3">
                        {switch name="$order->getData('status')"}
                        {case value="0"}
                        <a href="{:url('home/user/doPay',['orderId'=>$order->getData('id')])}" class="text-mod">去付款</a>
                        <br/>
                        <a href="#" class="text-mod" onclick=deleteOrder("cancel","{$order['id']}")>取消订单</a>
                        {/case}
                        {case value="1"}
                        <button type="button" class="btn btn-info" onclick=confirmReceipt("{$order['id']}")>确认收货
                        </button>
                        {/case}
                        {case value="2"}
                        <button type="button" class="btn btn-info" onclick=confirmReceipt("{$order['id']}")>确认收货
                        </button>
                        {/case}
                        {case value="3"}
                        <button type="button" class="btn btn-info" onclick=confirmReceipt("{$order['id']}")>确认收货
                        </button>
                        {/case}
                        {case value="4"}
                        <button type="button" class="btn btn-info" onclick=confirmReceipt("{$order['id']}")>确认收货
                        </button>
                        {/case}
                        {case value="5"}
                        <a class="text-mod" href="#" onclick=deleteOrder("delete","{$order['id']}")>删除订单</a>
                        {/case}
                        {case value="7"}
                        <a href="{:url('home/user/orderDetailed',['orderId'=>$order['id']])}" class="text-mod">订单详情</a>
                        <br/>
                        <a class="text-mod" href="#" onclick=deleteOrder("delete","{$order['id']}")>删除订单</a>
                        {/case}
                        {default /}
                        {/switch}
                    </td>
                </tr>
                <tr>
                    <td style="font-family: 微软雅黑;font-size: 15px;color: #ABABC3">
                        规格：{$order['orderSpecifications'][0]['specificationcontent']}
                    </td>
                </tr>
                <tr>
                    <td style="font-family: 微软雅黑;font-size: 15px;color: #ABABC3">下单时间：{:date('Y-m-d
                        H:i:s',$order['order_time'])}
                    </td>
                </tr>
            </table>
            <hr/>
            {/volist}
        </div>
        <!--第二层结束【我的订单】-->
        {$orders->render()}
    </div>
    <form action="{:url('home/user/placeOrder')}" method="post" id="CartSpecificationsPost">
        <input type="hidden" name="CartSpecificationsId" id="hi_checkId" value=""/>
    </form>
</div>

<script type="text/javascript">
    //确认收货
    function confirmReceipt(orderId) {
        if (confirm("请确保收到货后再确认收货，您收到货了吗？")) {
            $.ajax({
                type: "POST",
                url: "{:url('home/user/confirmReceipt')}",
                dataType: "json",
                data: {
                    orderId: orderId
                },
                success: function (msg) {
                    switch (msg) {
                        case "ReceiptSuccess":
                            var url = "{:url('home/user/orderDetailed?orderId=')}";
                            var pot = url.indexOf(".");
                            url = url.substring(0, pot);
                            url = url + "?orderId=" + orderId;
//                                alert(url);
                            window.location = url;
                            break;
                        case "PostError":
                            //非法请求
                            alert("非法请求");
                            break;
                        case "ParameterError":
                            //参数错误
                            alert("参数错误！");
                            break;
                        case "OrderNull":
                            alert('这个订单从地球上消失了~~');
                            break;
                        default:
                    }
                },
                error: function (msg) {
                    alert(msg);
                },
            });
        }
    }

    function deleteOrder(type, orderId) {
        if (type != "" && orderId != "") {
            var t = "";
            if (type == "delete") {
                t = "删除";
            } else if (type == "cancel") {
                t = "取消"
            }
            if (confirm("您确定要" + t + "此订单吗？")) {
                $.ajax({
                    type: "POST",
                    url: "{:url('home/user/deleteOrder')}",
                    dataType: "json",
                    data: {
                        orderId: orderId,
                        type: type
                    },
                    success: function (msg) {
                        switch (msg) {
                            case "success":
                                document.location.reload();//当前页面
                                break;
                            case "PostError":
                                //非法请求
                                alert("非法请求");
                                break;
                            case "ParameterError":
                                //参数错误
                                alert("参数错误！");
                                break;
                            case "OrderNull":
                                alert('这个订单从地球上消失了~~');
                                break;
                            case "TypeError":
                                alert('类型错误！');
                                break;
                            default:
                        }
                    },
                    error: function (msg) {
                        alert(msg);
                    },
                });
            }
        } else {
            alert("参数错误！");
        }
    }
</script>


