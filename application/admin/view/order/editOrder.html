{layout name="layout" /}
<block name="title"><title>修改订单</title></block>
<block name="resources">
    {load href="__PUBLIC__/static/js/area.js" /}
</block>

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-list"></i> 修改订单信息</h3>
    </div>
    <div class="panel-body">
        <!--表单数据-->
        <form method="post" action="/index.php/Admin/Order/edit_order" id="order-add">
            <div class="tab-pane">
                <table class="table table-bordered">
                    <tbody>
                    <tr>
                        <td>收货人:</td>
                        <td>
                            <div class="form-group ">
                                <div class="col-xs-2">
                                    <input name="consignee" id="consignee" value="{$order['address']['user_name']}"
                                           class="form-control" placeholder="收货人名字">
                                </div>
                                <div class="col-xs-2">
                                    <span id="err_consignee" style="color:#F00; display:none;">收货人名字不能为空</span>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>手机:</td>
                        <td>
                            <div class="form-group ">
                                <div class="col-xs-2">
                                    <input name="mobile" id="mobile" value="{$order['address']['phone']}"
                                           class="form-control" placeholder="收货人联系电话">
                                </div>
                                <div class="col-xs-2">
                                    <span id="err_mobile" style="color:#F00; display:none;">收货人电话不能为空</span>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>地址:</td>
                        <td>
                            <div class="form-group ">
                                <div class="col-xs-5">
                                    <input type="text" id="new_xiangxi" value="{$order['address']['content']}" class="form-control" placeholder="详细地址">
                                </div>
                            </div>
                            <div class="col-xs-2">
                                <span id="err_address" style="color:#F00; display:none;">请完善收货地址</span>
                            </div>
            </div>
            </td>
            </tr>
            <tr>
                <td>商品列表:</td>
                <td>
                    <div class="form-group">
                        <div class="col-xs-10">
                            <table class="table table-bordered">
                                <thead>
                                <tr>
                                    <td class="text-left">商品名称</td>
                                    <td class="text-left">规格</td>
                                    <td class="text-left">价格</td>
                                    <td class="text-left">数量</td>
                                    <td class="text-left">操作</td>
                                </tr>
                                </thead>
                                <tbody>
                                {volist name="$order['orderSpecifications']" id="item" key="key"}
                                <tr>
                                    <td class="text-left">{$item['specification']['commodity']['title']}</td>
                                    <td class="text-left">
                                        {$item['specification']['content']}
                                    </td>
                                    <td class="text-left">{$item['specification']['price']}</td>
                                    <td class="text-left">
                                        <input name="spec[]" rel="77" value="77" type="hidden">
                                        <input class="input-sm" name="old_goods[916]" value="{$item['count']}"
                                               onkeyup="this.value=this.value.replace(/[^\d.]/g,'')"
                                               onpaste="this.value=this.value.replace(/[^\d.]/g,'')"
                                               type="text"></td>
                                    <td class="text-left"><a href="javascript:void(0)"
                                                             onclick="javascript:$(this).parent().parent().remove();">删除</a>
                                    </td>
                                </tr>
                                {/volist}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-xs-10" id="goods_td">

                        </div>
                    </div>
                </td>
            </tr>

            </tbody>
            </table>
    </div>
    <input name="id" value="799" type="hidden">
    <button class="btn btn-info" type="button" onclick="checkSubmit()">
        <i class="ace-icon fa fa-check bigger-110"></i>
        保存
    </button>
    </form>
</div>
</div>
<script type="text/javascript">
    var Gid = document.getElementById;
    var showArea = function () {
        Gid('show').innerHTML = "<h3>" + Gid('s_province').value + " - " +
                Gid('s_city').value + " - " +
                Gid('s_county').value + "</h3>"
    }
    Gid('s_county').setAttribute('onchange', 'showArea()');
    function toNewAddress() {
        var addressName = document.getElementById("addressName");
        var addressNameStr = addressName.value;
        var s_province = $('#s_province option:selected').val();//选中的值
        var s_city = $('#s_city option:selected').val();
        var s_county = $('#s_county option:selected').val();
        var new_xiangxi = document.getElementById("new_xiangxi");
        var new_xiangxiStr = new_xiangxi.value;
        var addressContent = "地址：" + s_province + " " + s_city + " " + s_county + " " + new_xiangxiStr;
        var new_phone = document.getElementById("new_phone");
        var new_phoneStr = new_phone.value;
        if (addressNameStr != "" && addressContent != "" && new_phoneStr != "") {
            $.ajax({
                type: "POST",
                url: "{:url('home/user/addAddress')}",
                dataType: "json",
                data: {
                    addressNameStr: addressNameStr,
                    addressContent: addressContent,
                    new_phoneStr: new_phoneStr
                },
                success: function (msg) {
                    switch (msg) {
                        case "ReceiptSuccess":
                            document.location.reload();//当前页面
                            break;
                        case "PostError":
                            //非法请求
                            alert("非法请求");
                            break;
                        case "ParameterError":
                            //参数错误
                            alert("参数错误！");
                            break;
                        default:
                    }
                },
                error: function (msg) {
                    alert(msg);
                },
            });
        } else {
            alert('地址未填写完整！');
        }
    }
</script>
<script type="text/javascript">_init_area();</script>